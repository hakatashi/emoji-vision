<!DOCTYPE html>
<svg width="960" height="960" font-family="sans-serif" font-size="10" text-anchor="middle" style="margin: 0 auto; display: block;"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

let svg = d3.select('svg'),
	width = Number(svg.attr('width')),
	height = Number(svg.attr('height'));

const format = d3.format(',d');

const color = d3.scaleOrdinal(d3.schemeCategory20c);

const pack = d3.pack()
	.size([width, height])
	.padding(1.5);

d3.csv('flare.csv', (d) => {
	d.count = parseInt(d.count);
	return d;
}, (error, classes) => {
	if (error) {
		throw error;
	}

	const root = d3.hierarchy({children: classes})
		.sum((d) => d.count)
		.each((d) => {
			d.id = d.data.name;
			d.class = 'hoge';
		});

	const node = svg.selectAll('.node')
		.data(pack(root).leaves())
		.enter().append('g')
		.attr('class', 'node')
		.attr('transform', (d) => `translate(${d.x},${d.y})`);

	node.append('circle')
		.attr('id', (d) => d.id)
		.attr('r', (d) => d.r)
		.style('fill', (d) => color(d.id));

	node.append('image')
		.attr('href', (d) => `https://rawgit.com/twitter/twemoji/gh-pages/svg/${d.data.unified.toLowerCase()}.svg`)
		.attr('transform', (d) => `scale(${d.r / 75 * 0.8}) translate(-75, -75)`);

	node.append('clipPath')
		.attr('id', (d) => `clip-${d.id}`)
		.append('use')
		.attr('xlink:href', (d) => `#${d.id}`);

	node.append('title')
		.text((d) => `${d.id}\n${format(d.value)}`);
});

</script>
